# name: test/sql/spja.test
# description: test lineage capture and querying
# group: [sql]


require lineage

statement ok
LOAD lineage;

statement ok
CREATE TABLE t (id INTEGER, val INTEGER);

statement ok
INSERT INTO t VALUES
    (1, 10),
    (2, 20),
    (3, 30);

statement ok
PRAGMA set_lineage(True);

query I
SELECT count() FROM t
----
3

query I
SELECT id FROM t WHERE val > 15;
----
2
3

query I
SELECT id FROM t WHERE val > 15 ORDER BY id;
----
2
3

query II
SELECT t1.id, t2.id FROM t as t1, t as t2
----
1	1
2	1
3	1
1	2
2	2
3	2
1	3
2	3
3	3


statement ok
PRAGMA set_lineage(False);

statement ok
PRAGMA PrepareLineage(0);

statement ok
PRAGMA PrepareLineage(1);

statement ok
PRAGMA PrepareLineage(2);

statement ok
PRAGMA PrepareLineage(3);

query II
SELECT output_id, opid_2_t FROM read_block(0);
----
0	0
0	1
0	2


query II
SELECT output_id, opid_1_t FROM read_block(1);
----
0	1
1	2

query II
SELECT output_id, opid_4_t FROM read_block(2);
----
0	1
1	2

query III
SELECT output_id, opid_3_t, opid_2_t FROM read_block(3);
----
0	0	0
1	0	1
2	0	2
3	1	0
4	1	1
5	1	2
6	2	0
7	2	1
8	2	2

statement ok
PRAGMA clear_lineage;

